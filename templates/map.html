{% extends "layout.html" %}
{% set active_page = "map" %}

{% block header %}
    <style>
        .background {
            fill: none;
            pointer-events: all;
        }

        #states {
            fill: #aaa;
        }

            #states .active {
                fill: orange;
            }

        #state-borders {
            fill: none;
            stroke: #fff;
            stroke-width: 1.5px;
            stroke-linejoin: round;
            stroke-linecap: round;
            pointer-events: none;
        }
    </style>
{% endblock %}
{% block content %}
<div id="container">
    <div id="info"><p id="name"></p></div>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script>

        var width = 960,
            height = 600,
            centered;

        var projection = d3.geo.conicConformal()
        .rotate([-132, 0])
        .center([0, -27])
        .parallels([-18, -36])
        .scale(Math.min(height * 1.2, width * 0.8))
        .translate([width / 2, height / 2])
        .precision(0.1);

        var path = d3.geo.path()
            .projection(projection);

        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

        svg.append("rect")
            .attr("class", "background")
            .attr("width", width)
            .attr("height", height)
            .on("click", clicked);

        var g = svg.append("g");

        d3.json("static/geo/australia.json", function (error, aus) {
            if (error) throw error;

            g.append("g")
                .attr("id", "states")
              .selectAll("path")
                .data(topojson.feature(aus, aus.objects.states).features)
              .enter().append("path")
                .attr("d", path)
                .on("click", clicked)
                .on('mouseover', function (d) {
                    var name = d.properties.name;
                    return document.getElementById('name').innerHTML = name;
                });

            g.append("path")
                .datum(topojson.mesh(aus, aus.objects.states, function (a, b) { return a !== b; }))
                .attr("id", "state-borders")
                .attr("d", path);
        });

        function clicked(d) {
            var x, y, k;

            if (d && centered !== d) {
                var centroid = path.centroid(d);
                x = centroid[0];
                y = centroid[1];
                k = 2;
                centered = d;
            } else {
                x = width / 2;
                y = height / 2;
                k = 1;
                centered = null;
            }

            g.selectAll("path")
                .classed("active", centered && function (d) { return d === centered; });

            g.transition()
                .duration(750)
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
                .style("stroke-width", 1.5 / k + "px");
        }

    </script>
    <p>Hello</p>
</div>

{% endblock content %}
